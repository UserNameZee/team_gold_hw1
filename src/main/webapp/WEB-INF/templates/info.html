<!DOCTYPE html>
< xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" th:href="@{css/style.css}">
<link rel="icon" type="image/png" href="../img/favicon-32x32.png" sizes="32x32" />
<script src="webjars/jquery/3.3.1/jquery.min.js"></script>
<script>
  $(document).ready(function () {
    console.log($("userName").load("/loadUserInfo"));
    $(".userName").load("/loadUserInfo"); // 加载用户信息
  });

  $(document).ready(function (){
    $("#newGame").click(function(){
      window.location.href= "game.html";
    })
  });
</script>
<head>
  <meta charset="UTF-8">
  <title>Stratego - Info</title>
</head>
<div class="sidenav">
  <tr>
    <td>
      <p style="font-size: xx-large; text-align: center;" class = "userName">User Name</p>
    </td>
  </tr>
  <tr></tr>
  <tr>
    <td>
      <button class = btn2 type = "button" id = "newgame_btn" style="text-align: center"> New Game </button>
    </td>
  </tr>
  <tr>
    <td>
      <button class = btn2 type = "button" id = "continue_btn" disabled style="text-align: center"> Continue </button>
    </td>
  </tr>
</div>

<body class="background">
<div class = "content">
  <h1 class="info-title">Last Game </h1>
  <table class="table  table-striped table-bordered table-sm" cellspacing="0" width="100%">
    <thead>
    <tr>
      <th class="th-sm">Time</th>
      <th class="th-sm">Chess Remain</th>
    </tr>
    </thead>
    <tbody class="info-center lastTable">
    </tbody>
  </table>

  <div style="color: white; length: 150px"  ></div>

  <h1 class="info-title"> Game History</h1>
  <div class = "scrollbar table-wrapper-scroll-y">
    <table id="js/info.js" class="table  table-striped table-bordered table-sm" cellspacing="0" width="100%">
      <thead>
      <tr>
        <th class="th-sm">Time</th>
        <th class="th-sm">Game Result</th>
        <th class="th-sm">Pieces Remaining</th>
      </tr>
      </thead>
      <tbody class="info-center hsTable">
      </tbody>
    </table>
  </div>

</div>
</body>
<script>
  var allgame_arr;
  $.get("/rest/get_games", function(data){
    console.log(data);
    $(document).ready(function(){
      if(data !== undefined) {
        for (let i = 0; i < data.length; i++) {
          tr = $("<tr/>");
          tr.append("<td>" + data[i].time + "</td>>");
          tr.append("<td>" + data[i].result + "</td>>");
          tr.append("<td>" + "1-n" + "</td>>");
          $(".hsTable").append(tr);
        }
      }
    });
  })
</script>
<script>
  $("#newgame_btn").on("click", function(){
    $.post("/infoPage/set_continue_game", {isContinue : "false"}, function(result){
      if(result.success == "true"){
        window.location.href= "/game";
      }
    })
  })
</script>

<script>
  $.get("/rest/get_active", function(game) {
    if (game.finished == "false") {
      $("#continue_btn").prop("disabled", false);
    }
    console.log(game);
    console.log(game.pieces_left[0][2]);
    $(document).ready(function () {
      if (game !== undefined) {
        let i = 0;
        for (; i < game.pieces_left[0].length; i++) {
          ai = $("<tr/>");
          ai.append("<td>" + "AI:" + "</td>>");
          ai.append("<td>" + game.pieces_left[0][i] + "</td>>");
          $(".aiTable").append(ai);
        }

        let j = 0;
        for (; j < game.pieces_left[1].length; j++) {
          py = $("<tr/>");
          py.append("<td>" + "Player:" + "</td>>");
          $(".pyTable").append(py);
        }
      }

      tr = $("<tr/>");
      tr.append("<td>" + game.time + "</td>>");
      tr.append("<td>" +
              "<table class=\"table  table-striped table-bordered table-sm \" width=\"100%\">\n" +
              "    <thead>\n" +
              "    <tr>\n" +
              "      <th class=\"th-sm\">Side</th>\n" +
              "      <th class=\"th-sm\">B</th>\n" +
              "      <th class=\"th-sm\">1</th>\n" +
              "      <th class=\"th-sm\">2</th>\n" +
              "      <th class=\"th-sm\">3</th>\n" +
              "      <th class=\"th-sm\">4</th>\n" +
              "      <th class=\"th-sm\">5</th>\n" +
              "      <th class=\"th-sm\">6</th>\n" +
              "      <th class=\"th-sm\">7</th>\n" +
              "      <th class=\"th-sm\">8</th>\n" +
              "      <th class=\"th-sm\">9</th>\n" +
              "      <th class=\"th-sm\">10</th>\n"+
              "      <th class=\"th-sm\">F</th>\n" +
              "    </tr>\n" +
              "    </thead>\n" +
              "    <tbody class=\"info-center pyTable aiTable\">\n"+
              "    </tbody>\n" +
              "  </table>"
              + "</td>>");
      $(".lastTable").append(tr);
    });
  });



    $("#continue_btn").on("click", function () {
      $.post("/infoPage/set_continue_game", {isContinue: "true"}, function (result) {
        if (result.success == "true") {
          window.location.href = "/game";
        }
      })
    });

</script>
</html>